这个设计将无缝集成您提出的所有功能：
* **会员订阅与试用期**：情侣绑定后开启一个月试用。
* **权限体系**：付费用户、管理员、普通用户的区分。
* **数据安全**：所有数据均采用逻辑删除，无物理删除。
* **优雅的绑定流程**：通过有时效性的邀请码进行。
* **完整的订单管理**：追踪支付、退款等全生命周期。
* **智能的用户体验**：支持解绑后数据保留与智能重新绑定。
* **主动的用户沟通**：内置自动化通知中心。
* **灵活的运营能力**：通过优惠码系统和动态应用配置。
* **强大的可追溯性**：通过详细的活动日志和设备管理。
这套设计共包含 **10 个核心数据表**，它们共同构成了一个健壮、安全且极易扩展的系统。
---
### **数据库整体蓝图 (10个核心表)**

1. **`app_config`**: **应用动态配置表** - 控制应用的核心业务参数。
2. **`users`**: **用户表** - 存储用户基础信息、状态及权限。
3. **`user_devices`**: **用户设备表** - 管理用户设备，用于精准推送通知。
4. **`couples`**: **情侣关系表** - 系统的核心，管理情侣关系、试用期及订阅状态。
5. **`couple_invitations`**: **情侣邀请码表** - 管理安全的、有时效性的绑定邀请流程。
6. **`subscriptions`**: **订阅订单表** - 记录所有支付订单的完整生命周期。
7. **`promo_codes`**: **优惠码表** - 支撑所有营销活动的灵活优惠码系统。
8. **`events`**, **`sweet_messages`**, **`mood_tags`**: **核心内容表** - 存储用户创建的所有记仇/甜蜜事件、留言和情绪标签。
9. **`notifications`**: **通知中心表** - 存储发送给用户的系统和业务通知。
10. **`activity_logs`**: **活动日志表** - 系统的"黑匣子"，记录所有关键操作，用于审计和问题排查。

---

### **1. `app_config` (应用动态配置表)**

**用途**：实现应用核心参数的后台动态调整，无需修改代码和重新部署。运营人员的"控制面板"。

| 字段名 (Field Name) | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults) | 描述 (Description)                                                                                             |
| :------------------ | :--------------------- | :--------------------------------- | :--------------------------------------------------------------------------------------------------------------- |
| `key`               | `VARCHAR(100)`         | `PRIMARY KEY`                      | **配置项的唯一键**。例如 `trial_duration_days`。                                                                  |
| `value`             | `TEXT`                 | `NOT NULL`                         | **配置项的值**。使用 `TEXT` 类型以支持各种格式，如数字、JSON字符串等。例如 `30`。                                  |
| `description`       | `VARCHAR(255)`         | `NOT NULL`                         | **配置项的详细描述**。解释这个配置项的作用，方便后台管理。例如 "新情侣绑定的免费试用天数"。                  |
| `updated_at`        | `TIMESTAMPTZ`          | `DEFAULT NOW()`                    | 该配置项的最后更新时间（带时区）。                                                                               |

### **2. `users` (用户表)**

**用途**：存储所有独立用户的身份、状态和权限信息。

| 字段名 (Field Name) | PostgreSQL 类型 (Type)                   | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                                              |
| :------------------ | :--------------------------------------- | :--------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                | `UUID`                                   | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | **用户的唯一ID**。使用UUID，更安全，避免被顺序猜测。                                                                                              |
| `openid`            | `VARCHAR(255)`                           | `UNIQUE`, `NOT NULL`                                                   | **微信OpenID**，用户的登录凭证。                                                                                                                |
| `couple_id`         | `UUID`                                   | `NULL`, `FOREIGN KEY` -> `couples(id)`                                 | **当前所属情侣关系的ID**。用户在任意时刻只能属于一个`active`的情侣关系。解绑后此字段可设为`NULL`。                                            |
| `nickname`          | `VARCHAR(255)`                           | `NULL`                                                                 | 用户的昵称。                                                                                                                                  |
| `avatar_url`        | `TEXT`                                   | `NULL`                                                                 | 用户的头像URL。                                                                                                                                 |
| `display_gender`    | `VARCHAR(50)`                            | `NOT NULL`                                                             | 用户选择的用于内容显示的性别，决定主题色。                                                                                                      |
| `bio`               | `TEXT`                                   | `NULL`                                                                 | **用户的个人简介**。                                                                                                                              |
| `preferences`       | `JSONB`                                  | `NOT NULL`, `DEFAULT '{}'::jsonb`                                      | **用户偏好设置**。例如 `{"theme": "dark", "notifications": {"new_event_push": true}}`。                                                               |
| `last_login_at`     | `TIMESTAMPTZ`                            | `NULL`                                                                 | **用户最后登录时间**。                                                                                                                          |
| `is_admin`          | `BOOLEAN`                                | `DEFAULT FALSE`                                                        | **是否为管理员**。管理员及其伴侣将拥有无限的访问权限，不受订阅限制。                                                                              |
| `status`            | `VARCHAR(50)`                            | `NOT NULL`, `DEFAULT 'active'`, `CHECK (status IN ('active', 'suspended', 'deleted'))` | **账户状态**。`active`: 正常； `suspended`: 被封禁； `deleted`: 用户注销（逻辑删除）。                                                      |
| `created_at`        | `TIMESTAMPTZ`                            | `DEFAULT NOW()`                                                        | 用户记录创建时间。                                                                                                                              |
| `updated_at`        | `TIMESTAMPTZ`                            | `DEFAULT NOW()`                                                        | 用户记录更新时间。                                                                                                                              |

### **3. `user_devices` (用户设备表)**

**用途**：管理与用户账户关联的所有设备，专用于实现精准、可靠的推送通知。

| 字段名 (Field Name) | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                | 描述 (Description)                                                                                                                               |
| :------------------ | :--------------------- | :------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`       | 记录的唯一ID。                                                                                                                                   |
| `user_id`           | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `users(id)`          | **关联的用户ID**。                                                                                                                               |
| `device_type`       | `VARCHAR(50)`          | `NOT NULL`, `CHECK (device_type IN ('ios', 'android', 'web'))` | **设备类型**。                                                                                                                                   |
| `push_token`        | `TEXT`                 | `UNIQUE`, `NOT NULL`                              | **用于推送的设备令牌**。由客户端（小程序/App）提供，可能会变化，需要更新。`UNIQUE`确保不会重复推送。                                                   |
| `last_seen_at`      | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                   | **设备最后活跃时间**。可用于清理长期不活跃的无效设备令牌。                                                                                       |
| `created_at`        | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                   | 记录创建时间。                                                                                                                                   |

### **4. `couples` (情侣关系表)**

**用途**：系统的枢纽。定义一个唯一的情侣关系实体，并附着其共享的状态，如试用期、订阅资格和关系状态。

| 字段名 (Field Name)          | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                                                                                |
| :--------------------------- | :--------------------- | :--------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                         | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | **情侣关系的唯一ID**。                                                                                                                                                              |
| `anniversary_date`           | `DATE`                 | `NOT NULL`                                                             | 情侣的纪念日。                                                                                                                                                                    |
| `connection_score`           | `NUMERIC(5, 2)`        | `NOT NULL`, `DEFAULT 50.00`, `CHECK (connection_score >= 0 AND connection_score <= 100)` | **亲密度分数**。根据事件动态更新，范围0-100。                                                                                                                                   |
| `trial_ends_at`              | `TIMESTAMPTZ`          | `NULL`                                                                 | **免费试用期结束时间**。在情侣成功绑定时，由后端计算 `NOW() + '1 month'` 并填入此字段。                                                                                          |
| `subscription_expires_at`    | `TIMESTAMPTZ`          | `NULL`                                                                 | **付费订阅到期时间**。当用户成功支付后，后端会更新此字段。这是判断会员资格的核心。                                                                                              |
| `status`                     | `VARCHAR(50)`          | `NOT NULL`, `DEFAULT 'active'`, `CHECK (status IN ('active', 'unbound'))` | **关系状态**。`active`: 正常绑定中； `unbound`: 已解绑（逻辑删除）。`unbound`状态用于支持智能重新绑定，保留历史数据。                                                          |
| `created_at`                 | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                                        | 情侣关系创建时间。                                                                                                                                                                |
| `updated_at`                 | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                                        | 情侣关系更新时间（例如解绑时）。                                                                                                                                                  |

### **5. `couple_invitations` (情侣邀请码表)**

**用途**：管理安全、有时效性的绑定邀请流程，防止恶意或错误绑定。

| 字段名 (Field Name)   | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                    |
| :-------------------- | :--------------------- | :--------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- |
| `id`                  | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | 邀请记录的唯一ID。                                                                                                    |
| `inviter_user_id`     | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `users(id)`                               | **邀请发起方的用户ID**。                                                                                                |
| `invite_code`         | `VARCHAR(10)`          | `UNIQUE`, `NOT NULL`                                                   | **唯一的邀请码**。由后端生成，例如一个6位长的随机字符串。必须是唯一的且有索引，以便快速查找。                        |
| `status`              | `VARCHAR(50)`          | `NOT NULL`, `DEFAULT 'pending'`, `CHECK (status IN ('pending', 'accepted', 'expired'))` | **邀请状态**。`pending`: 等待接受； `accepted`: 已被使用； `expired`: 已过期。                                         |
| `expires_at`          | `TIMESTAMPTZ`          | `NOT NULL`                                                             | **邀请码过期时间**。例如，创建后的24小时。后端定时任务可以清理过期的邀请。                                                |
| `accepted_by_user_id` | `UUID`                 | `NULL`, `FOREIGN KEY` -> `users(id)`                                   | **接受邀请的用户ID**。当邀请被接受时，填入此字段。                                                                    |
| `created_at`          | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                                        | 邀请创建时间。                                                                                                        |

### **6. `subscriptions` (订阅订单表)**

**用途**：记录每一笔订阅支付的详细信息，构成完整的商业交易记录，支持财务对账和客服查询。

| 字段名 (Field Name)         | PostgreSQL 类型 (Type)     | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                                                   |
| :-------------------------- | :------------------------- | :--------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                        | `UUID`                     | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | **订单的唯一ID**。                                                                                                                                     |
| `couple_id`                 | `UUID`                     | `NOT NULL`, `FOREIGN KEY` -> `couples(id)`                             | **此订单为哪个情侣关系续期**。                                                                                                                         |
| `payer_user_id`             | `UUID`                     | `NOT NULL`, `FOREIGN KEY` -> `users(id)`                               | **支付方的用户ID**。明确记录是谁付的钱。                                                                                                               |
| `amount`                    | `NUMERIC(10, 2)`           | `NOT NULL`                                                             | **支付金额**。使用`NUMERIC`类型保证金额计算的精度，避免浮点数问题。                                                                                      |
| `currency`                  | `VARCHAR(3)`               | `NOT NULL`, `DEFAULT 'CNY'`                                            | **货币单位**。例如 `CNY`。                                                                                                                             |
| `duration_months`           | `SMALLINT`                 | `NOT NULL`                                                             | **购买的时长（月）**。例如 `1` 代表月度订阅，`12` 代表年度订阅。                                                                                       |
| `payment_provider`          | `VARCHAR(50)`              | `NOT NULL`, `CHECK (payment_provider IN ('wechat_pay', 'alipay', 'apple_iap'))` | **支付渠道**。                                                                                                                                         |
| `provider_transaction_id`   | `VARCHAR(255)`             | `UNIQUE`, `NOT NULL`                                                   | **支付渠道返回的交易号**。极其重要，用于和支付平台对账和处理退款。                                                                                       |
| `promo_code_id`             | `UUID`                     | `NULL`, `FOREIGN KEY` -> `promo_codes(id)`                             | **使用的优惠码ID**。如果用户使用了优惠码，则记录于此。                                                                                                 |
| `status`                    | `VARCHAR(50)`              | `NOT NULL`, `DEFAULT 'completed'`, `CHECK (status IN ('pending', 'completed', 'failed', 'refunded'))` | **订单状态**。`completed`: 成功； `pending`: 处理中； `failed`: 失败； `refunded`: 已退款。后端可根据此状态执行撤销会员等操作。               |
| `created_at`                | `TIMESTAMPTZ`              | `DEFAULT NOW()`                                                        | 订单创建时间。                                                                                                                                         |

### **7. `subscription_plans` (订阅套餐表)**

**用途**：定义所有可供销售的订阅套餐，方便后台动态管理。

| 字段名 (Field Name) | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                | 描述 (Description)                                                                                           |
| :------------------ | :--------------------- | :------------------------------------------------ | :----------------------------------------------------------------------------------------------------------- |
| `id`                | `TEXT`                 | `PRIMARY KEY`                                     | **套餐的唯一ID**。例如 `plan_yearly_249`。此ID用于前端发起购买请求。                                             |
| `name`              | `VARCHAR(255)`         | `NOT NULL`                                        | **套餐名称**。例如"年度会员"。                                                                               |
| `description`       | `TEXT`                 | `NOT NULL`                                        | **套餐的详细描述**。例如"原价¥300，立省¥51，畅享全年甜蜜"。                                                    |
| `price`             | `NUMERIC(10, 2)`       | `NOT NULL`                                        | **套餐价格**。                                                                                               |
| `currency`          | `VARCHAR(3)`           | `NOT NULL`, `DEFAULT 'CNY'`                       | **货币单位**。                                                                                               |
| `duration_months`   | `SMALLINT`             | `NOT NULL`                                        | **套餐包含的时长（月）**。                                                                                     |
| `tags`              | `TEXT[]`               | `NOT NULL`, `DEFAULT '{}'`                        | **套餐标签**。用于在UI上显示"最佳性价比"等角标。`TEXT[]`是PostgreSQL的数组类型。                              |
| `is_active`         | `BOOLEAN`              | `NOT NULL`, `DEFAULT TRUE`                        | **是否上架**。`FALSE`表示该套餐已下架，用户无法再购买。                                                      |
| `created_at`        | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                   | 创建时间。                                                                                                   |

### **8. `promo_codes` (优惠码表)**

**用途**：一个灵活的、支持多种营销活动的优惠码系统。

| 字段名 (Field Name)      | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                                    |
| :----------------------- | :--------------------- | :--------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| `id`                     | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | 优惠码记录的唯一ID。                                                                                                                  |
| `code`                   | `VARCHAR(50)`          | `UNIQUE`, `NOT NULL`                                                   | **优惠码本身**。例如 `VALENTINE2024`。应创建索引以便快速验证。                                                                          |
| `type`                   | `VARCHAR(50)`          | `NOT NULL`, `CHECK (type IN ('PERCENTAGE', 'FIXED_AMOUNT'))`           | **优惠类型**。`PERCENTAGE`: 百分比折扣； `FIXED_AMOUNT`: 固定金额减免。                                                                    |
| `value`                  | `NUMERIC(10, 2)`       | `NOT NULL`                                                             | **优惠数值**。如果类型是`PERCENTAGE`，存`10`代表10% (0.1)；如果是`FIXED_AMOUNT`，存`5.00`代表减5元。                                    |
| `max_usage_limit`        | `INT`                  | `NOT NULL`, `DEFAULT 1`                                                | **最大使用次数限制**。例如，一个通用码可以设置被使用1000次。                                                                          |
| `usage_count`            | `INT`                  | `NOT NULL`, `DEFAULT 0`                                                | **当前已被使用的次数**。每次使用后，此计数器加一。                                                                                    |
| `expires_at`             | `TIMESTAMPTZ`          | `NOT NULL`                                                             | **优惠码的过期时间**。                                                                                                                |
| `created_at`             | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                                        | 创建时间。                                                                                                                            |

### **9. `mood_tags` (情绪标签表)**

**用途**：定义所有可供用户选择的情绪标签及其属性。

| 字段名 (Field Name)             | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                | 描述 (Description)                                                                   |
| :------------------------------ | :--------------------- | :------------------------------------------------ | :----------------------------------------------------------------------------------- |
| `id`                            | `SERIAL`               | `PRIMARY KEY`                                     | **标签的唯一ID**。                                                                   |
| `name`                          | `VARCHAR(100)`         | `NOT NULL`, `UNIQUE`                              | **标签名称**。例如"生气"、"感动"。                                                  |
| `emoji_icon`                    | `VARCHAR(10)`          | `NOT NULL`                                        | **标签的Emoji图标**。例如 `😠`。                                                      |
| `category`                      | `VARCHAR(50)`          | `NOT NULL`, `CHECK (category IN ('positive', 'negative', 'neutral'))` | **标签分类**。用于统计分析。                                                         |
| `impact_on_connection_score`    | `NUMERIC(5, 2)`        | `NOT NULL`, `DEFAULT 0.00`                        | **对亲密度分数的影响值**。正数增加，负数减少。例如 `-5.00`。                           |
| `score`                         | `SMALLINT`             | `NOT NULL`, `CHECK (score >= 1 AND score <= 10)`  | **心情分数** (1-10分)，用于心情趋势图。                                               |

### **10. `events` (核心事件表)**

**用途**：存储用户创建的所有"记仇"或"甜蜜时刻"的帖子。

| 字段名 (Field Name) | PostgreSQL 类型 (Type)                   | 约束/默认值 (Constraints/Defaults)                                     | 描述 (Description)                                                                                                                                                                                                         |
| :------------------ | :--------------------------------------- | :--------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                | `UUID`                                   | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`                            | 事件的唯一ID。                                                                                                                                                                                                           |
| `couple_id`         | `UUID`                                   | `NOT NULL`, `FOREIGN KEY` -> `couples(id)`                             | 事件所属的情侣关系ID。                                                                                                                                                                                                   |
| `author_id`         | `UUID`                                   | `NOT NULL`, `FOREIGN KEY` -> `users(id)`                               | **事件创建者的用户ID**。                                                                                                                                                                                                 |
| `type`              | `VARCHAR(50)`                            | `NOT NULL`, `CHECK (type IN ('brainstorming', 'sweet_moment'))`        | **事件类型**。`brainstorming`: 头脑风暴（记仇）；`sweet_moment`: 甜蜜时刻。                                                                                                                                                |
| `description`       | `TEXT`                                   | `NOT NULL`                                                             | **事件的详细文字描述**。                                                                                                                                                                                                 |
| `mood_tag_id`       | `INT`                                    | `NOT NULL`, `FOREIGN KEY` -> `mood_tags(id)`                           | **关联的情绪标签ID**。                                                                                                                                                                                                   |
| `images`            | `TEXT[]`                                 | `NOT NULL`, `DEFAULT '{}'`                                             | **附带的图片URL列表**。`TEXT[]`是PostgreSQL的数组类型。                                                                                                                                                                  |
| `location_text`     | `VARCHAR(255)`                           | `NULL`                                                                 | **地理位置的文字描述**。例如"家里的沙发上"。                                                                                                                                                                             |
| `solution`          | `TEXT`                                   | `NULL`                                                                 | **解决办法**。仅当事件被解决时填写。                                                                                                                                                                                     |
| `status`            | `VARCHAR(50)`                            | `NOT NULL`, `DEFAULT 'unresolved'`, `CHECK (status IN ('unresolved', 'resolved', 'deleted'))` | **事件状态**。`unresolved`: 未解决； `resolved`: 已解决； `deleted`: 用户已删除（逻辑删除）。前端查询时，应默认只查询 `status != 'deleted'` 的事件。                                                              |
| `event_date`        | `DATE`                                   | `NOT NULL`                                                             | **事件实际发生的日期**。用户在创建时选择。                                                                                                                                                                               |
| `resolved_at`       | `TIMESTAMPTZ`                            | `NULL`                                                                 | **事件被解决的时间**。                                                                                                                                                                                                   |
| `created_at`        | `TIMESTAMPTZ`                            | `DEFAULT NOW()`                                                        | 事件记录创建时间。                                                                                                                                                                                                       |
| `updated_at`        | `TIMESTAMPTZ`                            | `DEFAULT NOW()`                                                        | 事件记录更新时间。                                                                                                                                                                                                       |

### **11. `event_reactions` (事件回应表)**

**用途**：记录伴侣对某个事件做出的Emoji心情回应。

| 字段名 (Field Name) | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                | 描述 (Description)                                                                                             |
| :------------------ | :--------------------- | :------------------------------------------------ | :------------------------------------------------------------------------------------------------------------- |
| `id`                | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`       | 回应记录的唯一ID。                                                                                             |
| `event_id`          | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `events(id)`         | **被回应的事件ID**。                                                                                           |
| `user_id`           | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `users(id)`          | **做出回应的用户ID**。                                                                                         |
| `emoji`             | `VARCHAR(10)`          | `NOT NULL`                                        | **回应的Emoji**。例如 `❤️`。                                                                                   |
| `created_at`        | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                   | 创建时间。                                                                                                     |
| **约束**          | `UNIQUE`               | `(event_id, user_id)`                             | **唯一性约束**：确保一个用户对一个事件只能有一个回应。                                                         |

### **12. `sweet_messages` (甜蜜留言表)**

**用途**：存储甜蜜留言板中的所有留言。

| 字段名 (Field Name) | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)                | 描述 (Description)                                                                                                    |
| :------------------ | :--------------------- | :------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------- |
| `id`                | `UUID`                 | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`       | 留言的唯一ID。                                                                                                        |
| `couple_id`         | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `couples(id)`        | 留言所属的情侣关系ID。                                                                                                |
| `author_id`         | `UUID`                 | `NOT NULL`, `FOREIGN KEY` -> `users(id)`          | **留言创建者的用户ID**。                                                                                                |
| `message`           | `TEXT`                 | `NOT NULL`                                        | **留言的具体内容**。                                                                                                  |
| `nickname`          | `VARCHAR(255)`         | `NOT NULL`                                        | **留言时使用的昵称**。每次都可以不同。                                                                                |
| `is_pinned`         | `BOOLEAN`              | `NOT NULL`, `DEFAULT FALSE`                       | **是否置顶**。                                                                                                        |
| `status`            | `VARCHAR(50)`          | `NOT NULL`, `DEFAULT 'active'`, `CHECK (status IN ('active', 'deleted'))` | **留言状态**。`active`: 正常显示； `deleted`: 用户已删除（逻辑删除）。                                               |
| `created_at`        | `TIMESTAMPTZ`          | `DEFAULT NOW()`                                   | 留言创建时间。                                                                                                        |

### **13. `notifications` (通知中心表)**

**用途**：一个轻量级的、应用内的通知系统，用于提升用户体验和关键信息传达。

| 字段名 (Field Name)             | PostgreSQL 类型 (Type)     | 约束/默认值 (Constraints/Defaults)           | 描述 (Description)                                                                                                                                 |
| :------------------------------ | :------------------------- | :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                            | `UUID`                     | `PRIMARY KEY`, `DEFAULT uuid_generate_v4()`  | 通知的唯一ID。                                                                                                                                     |
| `recipient_user_id`             | `UUID`                     | `NOT NULL`, `FOREIGN KEY` -> `users(id)`     | **通知接收者的用户ID**。                                                                                                                           |
| `type`                          | `VARCHAR(100)`             | `NOT NULL`                                   | **通知类型**。例如 `subscription_activated`, `subscription_expiring_soon`, `new_event_from_partner`。前端可根据此类型显示不同图标。          |
| `content`                       | `TEXT`                     | `NOT NULL`                                   | **通知的具体内容**。例如"您的伴侣刚刚记录了一件新的甜蜜时刻，快去看看吧！"。                                                                 |
| `is_read`                       | `BOOLEAN`                  | `DEFAULT FALSE`                              | **是否已读**。用于在UI上显示未读小红点。                                                                                                           |
| `related_resource_type`         | `VARCHAR(50)`              | `NULL`                                       | **关联的资源类型**。例如 `event`, `sweet_message`。                                                                                              |
| `related_resource_id`           | `UUID`                     | `NULL`                                       | **关联的资源ID**。与上一字段配合，实现点击通知后跳转到对应的事件详情页等功能。                                                                   |
| `created_at`                    | `TIMESTAMPTZ`              | `DEFAULT NOW()`                              | 通知创建时间。                                                                                                                                     |

### **14. `activity_logs` (活动日志表)**

**用途**：系统的"黑匣子"，记录所有关键的、不可抵赖的操作，用于安全审计、问题排查和客服支持。

| 字段名 (Field Name)      | PostgreSQL 类型 (Type) | 约束/默认值 (Constraints/Defaults)           | 描述 (Description)                                                                                                                                                                   |
| :----------------------- | :--------------------- | :------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                     | `BIGSERIAL`            | `PRIMARY KEY`                                | **日志的唯一ID**。使用 `BIGSERIAL` (自增长大整数) 即可，查询性能高。                                                                                                                     |
| `actor_user_id`          | `UUID`                 | `NULL`                                       | **操作发起方的用户ID**。如果是系统自动任务，此字段可为`NULL`。                                                                                                                         |
| `action_type`            | `VARCHAR(100)`         | `NOT NULL`                                   | **操作类型**。例如 `user_login`, `couple_bound`, `subscription_refunded`, `admin_granted_permission`。                                                                                 |
| `target_resource_type`   | `VARCHAR(50)`          | `NULL`                                       | **被操作的资源类型**。例如 `couple`, `user`, `event`。                                                                                                                               |
| `target_resource_id`     | `TEXT`                 | `NULL`                                       | **被操作的资源ID**。使用`TEXT`以兼容UUID或INT等各种ID。                                                                                                                                |
| `details`                | `JSONB`                | `NULL`                                       | **操作详情**。`JSONB`格式，可以记录操作前后的数据快照或其他上下文信息，例如 `{"from_status": "active", "to_status": "unbound"}`。                                                    |
| `ip_address`             | `INET`                 | `NULL`                                       | **操作者的IP地址**。`INET`是PostgreSQL专用于存储IP地址的类型。                                                                                                                         |
| `created_at`             | `TIMESTAMPTZ`          | `DEFAULT NOW()`                              | **操作发生时间**。                                                                                                                                                                   |

---

这套数据库设计为您的小程序构建了一个极其坚实和有远见的基础。它不仅完全实现了您当前的所有需求，还为未来的运营、营销和功能迭代预留了充足的扩展空间，确保您的项目可以从容应对各种挑战。