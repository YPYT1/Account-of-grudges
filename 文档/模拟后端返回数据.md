### **〇、全局API约定与通用响应格式**

本部分定义了所有API交互的基础规则。所有API都必须遵循以下响应结构和状态码约定。

#### **1. 通用响应结构**

所有API的响应都将包裹在以下JSON结构中：

```json
{
  "code": 200,          // number: 业务状态码，见下文定义
  "message": "Success", // string: 对本次响应的文本描述
  "data": { ... }       // object | array | null: 核心响应数据
}
```

#### **2. 成功响应**

*   **`GET`, `PUT`, `DELETE`**: 成功的响应 `code` 为 `200`。
*   **`POST` (创建新资源)**: 成功的响应 `code` 为 `201`。

#### **3. 失败响应**

所有失败的响应，`data` 字段均为 `null`。前端应通过 `code` 字段来判断错误的具体类型。

#### **4. 通用业务状态码 (Code) 定义**

| Code | HTTP状态(参考) | 含义             | 描述与前端处理建议                                                                               |
| :--- | :------------- | :--------------- | :----------------------------------------------------------------------------------------------- |
| `200`  | 200 OK         | **请求成功**       | 通用的成功状态。                                                                                 |
| `201`  | 201 Created    | **创建成功**       | 在通过 `POST` 请求成功创建一个新资源（如新帖子、新留言）时返回。                                   |
| `400`  | 400 Bad Request| **请求参数错误**   | 通常由客户端请求的参数不符合后端要求导致，例如字段缺失、格式错误。前端应提示用户修改输入。       |
| `401`  | 401 Unauthorized| **需要认证**       | 用户未登录或Token已失效。前端应拦截此响应，清除本地登录状态，并重定向到登录页面。                |
| `403`  | 403 Forbidden  | **权限不足**       | 用户已登录，但无权访问该资源（例如普通用户尝试删除他人帖子）。前端应给出"无权操作"的提示。       |
| `404`  | 404 Not Found  | **资源不存在**     | 请求的资源（如某个特定ID的帖子）在数据库中不存在。前端应显示"内容不存在"或"已被删除"的界面。 |
| `500`  | 500 Server Error| **服务器内部错误** | 后端服务器发生未知错误。这是一个通用错误，前端应向用户显示一个友好的"服务开小差了，请稍后再试"提示。 |

---

### **通用失败响应示例**

**`400 Bad Request` - 请求体验证失败**
```json
{
  "code": 400,
  "message": "请求参数验证失败。",
  "data": null,
  "errors": {
    "description": "内容描述不能为空。",
    "event_date": "事件日期格式不正确，应为 YYYY-MM-DD。"
  }
}
```

**`401 Unauthorized` - 未登录或Token失效**
```json
{
  "code": 401,
  "message": "用户未认证或认证已过期，请重新登录。",
  "data": null
}
```

**`403 Forbidden` - 无权操作**
```json
{
  "code": 403,
  "message": "您没有权限执行此操作。",
  "data": null
}
```

**`404 Not Found` - 资源未找到**
```json
{
  "code": 404,
  "message": "您要查找的资源不存在。",
  "data": null
}
```

**`500 Internal Server Error` - 服务器内部错误**
```json
{
  "code": 500,
  "message": "服务器发生未知错误，请稍后重试或联系管理员。",
  "data": null
}
```

---

### **最终、完整、无删减版 · 超详细全功能 Mock 数据 API 契约**

---

### **第一部分：应用框架、认证与会员系统 API**

#### **1. `GET /api/me` - 获取当前会话信息**
**用途**: 应用启动时必须调用的第一个、也是最重要的接口。它的响应决定了用户看到的是应用主界面、绑定界面还是支付弹窗。

**场景 1.1：管理员用户**
```json
{
  "code": 200,
  "message": "Session info for an admin retrieved successfully.",
  "data": {
    "access_status": "ADMIN",
    "currentUser": {
      "id": "a1b2c3d4-0001-4001-8001-0123456789ab",
      "openid": "openid-for-admin-user-01",
      "nickname": "阿涛 (管理员)",
      "avatar_url": "https://randomuser.me/api/portraits/men/32.jpg",
      "display_gender": "male",
      "bio": "系统的守护者，偶尔也记录生活。",
      "status": "active",
      "is_admin": true,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": false
        },
        "theme": "dark"
      },
      "last_login_at": "2023-10-27T10:00:00Z",
      "created_at": "2023-01-15T12:00:00Z"
    },
    "partner": {
      "id": "a1b2c3d4-0002-4002-8002-fedcba987654",
      "nickname": "小月",
      "avatar_url": "https://randomuser.me/api/portraits/women/44.jpg",
      "display_gender": "female",
      "bio": "爱画画，爱旅行，也爱身边的管理员先生。"
    },
    "coupleInfo": {
      "id": "c1p2l3e4-0001-4001-8001-abcdef123456",
      "anniversary_date": "2020-01-01",
      "trial_ends_at": null,
      "subscription_expires_at": null
    }
  }
}
```

**场景 1.2：付费订阅生效中的用户**
```json
{
  "code": 200,
  "message": "Session info for a subscribed user retrieved successfully.",
  "data": {
    "access_status": "FULL_ACCESS",
    "currentUser": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "openid": "openid-for-paid-user-03",
      "nickname": "付费用户A",
      "avatar_url": "https://randomuser.me/api/portraits/women/68.jpg",
      "display_gender": "female",
      "bio": "享受每一刻的甜蜜记录。",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "light"
      },
      "last_login_at": "2023-10-26T18:30:00Z",
      "created_at": "2022-08-01T11:00:00Z"
    },
    "partner": {
      "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff",
      "nickname": "付费用户B",
      "avatar_url": "https://randomuser.me/api/portraits/men/68.jpg",
      "display_gender": "male",
      "bio": "为我们的爱投资，值得。"
    },
    "coupleInfo": {
      "id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "anniversary_date": "2022-08-08",
      "trial_ends_at": "2022-09-08T12:00:00Z",
      "subscription_expires_at": "2024-09-08T12:00:00Z"
    }
  }
}
```

**场景 1.3：免费试用期内的用户**
```json
{
  "code": 200,
  "message": "Session info for a user in trial period retrieved successfully.",
  "data": {
    "access_status": "TRIAL",
    "currentUser": {
      "id": "c3d4e5f6-0005-4005-8005-abcdefabcdef",
      "openid": "openid-for-trial-user-05",
      "nickname": "试用用户A",
      "avatar_url": "https://randomuser.me/api/portraits/men/50.jpg",
      "display_gender": "male",
      "bio": "正在体验这个神奇的小程序！",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": false,
          "new_message_push": true
        },
        "theme": "system"
      },
      "last_login_at": "2023-10-27T14:00:00Z",
      "created_at": "2023-10-15T18:30:00Z"
    },
    "partner": {
      "id": "c3d4e5f6-0006-4006-8006-fedcbafedcba",
      "nickname": "试用用户B",
      "avatar_url": "https://randomuser.me/api/portraits/women/50.jpg",
      "display_gender": "female",
      "bio": "试用期感觉不错哦。"
    },
    "coupleInfo": {
      "id": "c1p2l3e4-0003-4003-8003-789789789789",
      "anniversary_date": "2023-10-15",
      "trial_ends_at": "2023-11-15T18:30:00Z",
      "subscription_expires_at": null
    }
  }
}
```

**场景 1.4：订阅/试用已到期的用户 (需要弹窗)**
```json
{
  "code": 200,
  "message": "Access expired. Subscription required.",
  "data": {
    "access_status": "EXPIRED",
    "currentUser": {
      "id": "d4e5f6g7-0007-4007-8007-778899aabbcc",
      "openid": "openid-for-expired-user-07",
      "nickname": "过期用户A",
      "avatar_url": "https://randomuser.me/api/portraits/women/25.jpg",
      "display_gender": "female",
      "bio": "我们的甜蜜时光需要续费啦...",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "light"
      },
      "last_login_at": "2023-10-27T14:10:00Z",
      "created_at": "2021-03-14T10:00:00Z"
    },
    "partner": {
      "id": "d4e5f6g7-0008-4008-8008-ccddeeff0011",
      "nickname": "过期用户B",
      "avatar_url": "https://randomuser.me/api/portraits/men/25.jpg",
      "display_gender": "male",
      "bio": "是时候充值信仰了。"
    },
    "coupleInfo": {
      "id": "c1p2l3e4-0004-4004-8004-101101101101",
      "anniversary_date": "2021-03-14",
      "trial_ends_at": "2021-04-14T10:00:00Z",
      "subscription_expires_at": "2022-04-14T10:00:00Z"
    }
  }
}
```

**场景 1.5：未绑定情侣的用户**
```json
{
  "code": 200,
  "message": "User is not bound to a couple.",
  "data": {
    "access_status": "UNBOUND",
    "currentUser": {
      "id": "e5f6g7h8-0009-4009-8009-1a2b3c4d5e6f",
      "openid": "openid-for-single-user-09",
      "nickname": "单身贵族C",
      "avatar_url": "https://randomuser.me/api/portraits/lego/1.jpg",
      "display_gender": "male",
      "bio": "寻找我的另一半。",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "system"
      },
      "last_login_at": "2023-10-27T14:20:00Z",
      "created_at": "2023-09-01T20:00:00Z"
    },
    "partner": null,
    "coupleInfo": null
  }
}
```

---

#### **2. `POST /api/couples/invitations` - 创建绑定邀请**
**请求体**: (空)
**响应**:
```json
{
  "code": 200,
  "message": "Invitation created successfully.",
  "data": {
    "invite_code": "A8C3F9",
    "expires_at": "2023-10-28T14:55:00Z"
  }
}
```

---

#### **3. `POST /api/couples/accept-invitation` - 接受绑定邀请**
**请求体**: `{ "invite_code": "A8C3F9" }`
**响应**:
```json
{
  "code": 200,
  "message": "Couple bound successfully! Welcome to your trial period.",
  "data": {
    "access_status": "TRIAL",
    "currentUser": {
      "id": "f6g7h8i9-0010-4010-8010-1b2c3d4e5f6a",
      "openid": "openid-for-new-user-10",
      "nickname": "用户B",
      "avatar_url": "https://randomuser.me/api/portraits/women/10.jpg",
      "display_gender": "female",
      "bio": "我们开始吧！",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "system"
      },
      "last_login_at": "2023-10-27T15:00:00Z",
      "created_at": "2023-10-27T14:59:00Z"
    },
    "partner": {
      "id": "e5f6g7h8-0009-4009-8009-1a2b3c4d5e6f",
      "nickname": "单身贵族C",
      "avatar_url": "https://randomuser.me/api/portraits/lego/1.jpg",
      "display_gender": "male",
      "bio": "寻找我的另一半。"
    },
    "coupleInfo": {
      "id": "d2e3f4g5-0005-4005-8005-zyxwutsrqpon",
      "anniversary_date": "2023-10-27",
      "trial_ends_at": "2023-11-27T15:00:00Z",
      "subscription_expires_at": null
    }
  }
}
```

---

#### **4. `GET /api/subscriptions/plans` - 获取可订阅的套餐**
**响应**:
```json
{
  "code": 200,
  "message": "Subscription plans retrieved successfully.",
  "data": [
    {
      "id": "plan_monthly_25",
      "name": "月度会员",
      "description": "按月订阅，灵活方便，随时取消",
      "price": "25.00",
      "currency": "CNY",
      "duration_months": 1,
      "tags": []
    },
    {
      "id": "plan_yearly_249",
      "name": "年度会员",
      "description": "原价¥300，立省¥51，畅享全年甜蜜",
      "price": "249.00",
      "currency": "CNY",
      "duration_months": 12,
      "tags": ["最佳性价比", "立省17%"]
    }
  ]
}
```

---

#### **5. `POST /api/subscriptions` - 创建订阅订单**
**请求体**: `{ "plan_id": "plan_yearly_249", "promo_code": "SWEETLOVE25" }`

**场景 5.1：优惠码有效**
```json
{
  "code": 200,
  "message": "Order created successfully. Please proceed to payment.",
  "data": {
    "order_id": "ord-uuid-01234567-89ab-cdef-0123-456789abcdef",
    "plan_name": "年度会员",
    "original_amount": "249.00",
    "discount_amount": "25.00",
    "final_amount": "224.00",
    "payment_gateway_payload": {
      "appId": "wx123456789abcde",
      "timeStamp": "1698415200",
      "nonceStr": "aRandomNonceStringForSecurity",
      "package": "prepay_id=wxprepayid123456789abcdefghijkl",
      "signType": "MD5",
      "paySign": "A_VERY_VERY_VERY_LONG_SIGNATURE_STRING_GENERATED_BY_BACKEND"
    }
  }
}
```

**场景 5.2：优惠码无效**
```json
{
  "code": 400,
  "message": "优惠码 'INVALIDCODE' 无效或已过期。",
  "data": null
}
```

---

#### **6. `GET /api/notifications` - 获取通知中心列表**
**响应**:
```json
{
  "code": 200,
  "message": "Notifications retrieved successfully.",
  "data": {
    "unread_count": 1,
    "notifications": [
      {
        "id": "noti-uuid-001-expiring",
        "type": "subscription_expiring_soon",
        "content": "您的会员资格将于 2023年11月15日 到期，为避免影响使用，请及时续费。",
        "is_read": false,
        "related_resource_type": null,
        "related_resource_id": null,
        "created_at": "2023-11-08T10:00:00Z"
      },
      {
        "id": "noti-uuid-002-new-event",
        "type": "new_event_from_partner",
        "content": "您的伴侣"小月"刚刚记录了一件新的甜蜜时刻，快去看看吧！",
        "is_read": true,
        "related_resource_type": "event",
        "related_resource_id": "evt-uuid-002",
        "created_at": "2023-10-25T23:05:00Z"
      },
      {
        "id": "noti-uuid-003-activated",
        "type": "subscription_activated",
        "content": "感谢您的支持！您的年度会员已成功激活，有效期至 2024年11月08日。",
        "is_read": true,
        "related_resource_type": null,
        "related_resource_id": null,
        "created_at": "2023-11-08T12:30:00Z"
      }
    ]
  }
}
```

---
---

### **第二部分：核心内容 API (帖子信息)**

#### **7. `GET /api/events?status=unresolved` - 获取首页帖子列表 (未解决)**
**响应**:
```json
{
  "code": 200,
  "message": "Unresolved events retrieved successfully.",
  "data": [
    {
      "id": "evt-uuid-001",
      "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "type": "brainstorming",
      "description": "说好的一起看电影，结果开场十分钟就睡着了，呼噜打得比电影声还响！",
      "status": "unresolved",
      "solution": null,
      "event_date": "2023-10-26",
      "images": [],
      "location_text": "家里的沙发上",
      "author": {
        "id": "b2c3d4e5-0003-4003-8003-112233445566",
        "nickname": "付费用户A",
        "display_gender": "female"
      },
      "mood_tag": {
        "id": 1,
        "name": "生气",
        "emoji_icon": "😠"
      },
      "reactions": [],
      "resolved_at": null,
      "created_at": "2023-10-26T22:30:00Z",
      "updated_at": "2023-10-26T22:30:00Z"
    },
    {
      "id": "evt-uuid-002",
      "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "type": "sweet_moment",
      "description": "今天加班到很晚，回家发现他给我炖了汤，还准备了小惊喜，太感动了。",
      "status": "unresolved",
      "solution": null,
      "event_date": "2023-10-25",
      "images": [
        "https://images.pexels.com/photos/262959/pexels-photo-262959.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
      ],
      "location_text": null,
      "author": {
        "id": "b2c3d4e5-0003-4003-8003-112233445566",
        "nickname": "付费用户A",
        "display_gender": "female"
      },
      "mood_tag": {
        "id": 5,
        "name": "感动",
        "emoji_icon": "🥰"
      },
      "reactions": [
        { "author_id": "b2c3d4e5-0004-4004-8004-aabbccddeeff", "emoji": "❤️" }
      ],
      "resolved_at": null,
      "created_at": "2023-10-25T23:00:00Z",
      "updated_at": "2023-10-25T23:00:00Z"
    },
    {
      "id": "evt-uuid-003",
      "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "type": "brainstorming",
      "description": "又把脏袜子扔在了沙发上，说了一百遍了！每次都得我跟在后面收拾。",
      "status": "unresolved",
      "solution": null,
      "event_date": "2023-10-24",
      "images": [],
      "location_text": null,
      "author": {
        "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff",
        "nickname": "付费用户B",
        "display_gender": "male"
      },
      "mood_tag": {
        "id": 3,
        "name": "无语",
        "emoji_icon": "😑"
      },
      "reactions": [],
      "resolved_at": null,
      "created_at": "2023-10-24T08:15:00Z",
      "updated_at": "2023-10-24T08:15:00Z"
    }
  ]
}
```

---

#### **8. `GET /api/events?status=resolved` - 获取已解决帖子列表 (甜蜜档案)**
**响应**:
```json
{
  "code": 200,
  "message": "Resolved events retrieved successfully.",
  "data": [
    {
      "id": "evt-uuid-004-resolved",
      "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "type": "brainstorming",
      "description": "纪念日居然忘记了！一个礼物都没有，气死我了。",
      "status": "resolved",
      "solution": "罚他请我吃一个星期的大餐，并且补送了超漂亮的项链，这次就勉强原谅他了！以后再忘就没有这么简单了哼。",
      "event_date": "2023-09-09",
      "images": [
        "https://images.pexels.com/photos/1454157/pexels-photo-1454157.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
      ],
      "location_text": null,
      "author": {
        "id": "b2c3d4e5-0003-4003-8003-112233445566",
        "nickname": "付费用户A",
        "display_gender": "female"
      },
      "mood_tag": {
        "id": 2,
        "name": "委屈",
        "emoji_icon": "🥺"
      },
      "reactions": [],
      "resolved_at": "2023-09-10T18:00:00Z",
      "created_at": "2023-09-09T10:00:00Z",
      "updated_at": "2023-09-10T18:00:00Z"
    }
  ]
}
```

---

#### **9. `GET /api/events/{eventId}` - 获取单个帖子详情**

**场景 9.1：获取一个未解决的帖子详情**
```json
{
  "code": 200,
  "message": "Event details retrieved successfully.",
  "data": {
    "id": "evt-uuid-001",
    "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
    "type": "brainstorming",
    "description": "说好的一起看电影，结果开场十分钟就睡着了，呼噜打得比电影声还响！",
    "status": "unresolved",
    "solution": null,
    "event_date": "2023-10-26",
    "images": [],
    "location_text": "家里的沙发上",
    "author": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "nickname": "付费用户A",
      "display_gender": "female"
    },
    "mood_tag": {
      "id": 1,
      "name": "生气",
      "emoji_icon": "😠"
    },
    "reactions": [],
    "resolved_at": null,
    "created_at": "2023-10-26T22:30:00Z",
    "updated_at": "2023-10-26T22:30:00Z"
  }
}
```
**场景 9.2：获取一个已解决的帖子详情**
```json
{
  "code": 200,
  "message": "Event details retrieved successfully.",
  "data": {
    "id": "evt-uuid-004-resolved",
    "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
    "type": "brainstorming",
    "description": "纪念日居然忘记了！一个礼物都没有，气死我了。",
    "status": "resolved",
    "solution": "罚他请我吃一个星期的大餐，并且补送了超漂亮的项链，这次就勉强原谅他了！以后再忘就没有这么简单了哼。",
    "event_date": "2023-09-09",
    "images": [
      "https://images.pexels.com/photos/1454157/pexels-photo-1454157.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2"
    ],
    "location_text": null,
    "author": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "nickname": "付费用户A",
      "display_gender": "female"
    },
    "mood_tag": {
      "id": 2,
      "name": "委屈",
      "emoji_icon": "🥺"
    },
    "reactions": [],
    "resolved_at": "2023-09-10T18:00:00Z",
    "created_at": "2023-09-09T10:00:00Z",
    "updated_at": "2023-09-10T18:00:00Z"
  }
}
```

---

#### **10. `GET /api/mood-tags` - 获取所有可用的情绪标签**
**响应**:
```json
{
  "code": 200,
  "message": "Mood tags retrieved successfully.",
  "data": [
    { "id": 1, "name": "生气", "emoji_icon": "😠", "category": "negative", "impact_on_connection_score": -5, "score": 2 },
    { "id": 2, "name": "委屈", "emoji_icon": "🥺", "category": "negative", "impact_on_connection_score": -3, "score": 3 },
    { "id": 3, "name": "无语", "emoji_icon": "😑", "category": "negative", "impact_on_connection_score": -2, "score": 4 },
    { "id": 4, "name": "平常", "emoji_icon": "😐", "category": "neutral", "impact_on_connection_score": 0, "score": 6 },
    { "id": 5, "name": "感动", "emoji_icon": "🥰", "category": "positive", "impact_on_connection_score": 5, "score": 9 },
    { "id": 6, "name": "开心", "emoji_icon": "😄", "category": "positive", "impact_on_connection_score": 3, "score": 8 },
    { "id": 7, "name": "惊喜", "emoji_icon": "😮", "category": "positive", "impact_on_connection_score": 4, "score": 9 }
  ]
}
```

---

#### **11. `GET /api/sweet-messages` - 获取甜蜜留言板列表**
**响应**:
```json
{
  "code": 200,
  "message": "Sweet messages retrieved successfully.",
  "data": [
    {
      "id": "msg-uuid-001-pinned",
      "message": "亲爱的，今天是我们在一起的第520天，永远爱你哟！❤️",
      "nickname": "你的小宝贝",
      "is_pinned": true,
      "created_at": "2023-10-20T09:00:00Z",
      "author": { "id": "b2c3d4e5-0003-4003-8003-112233445566", "display_gender": "female" }
    },
    {
      "id": "msg-uuid-002",
      "message": "收到！也爱你，我的超人！未来的每一天都请多指教。",
      "nickname": "你的专属骑士",
      "is_pinned": false,
      "created_at": "2023-10-20T09:05:00Z",
      "author": { "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff", "display_gender": "male" }
    }
  ]
}
```

---
---

### **第三部分：核心交互、分析与用户操作 API**

#### **12. `POST /api/events` - 新建帖子（事件）**
**用途**: 用户填写完帖子内容并点击"发布"后，前端调用此接口。

**请求体 (Request Body)**:
```json
{
  "type": "brainstorming",
  "description": "又玩游戏到半夜一点才睡，说好了要早睡的呢！",
  "event_date": "2023-10-28",
  "mood_tag_id": 1,
  "images": [],
  "location_text": "卧室"
}
```

**响应 (Response)**: (成功后，后端返回完整的新建帖子对象)
```json
{
  "code": 201,
  "message": "Event created successfully.",
  "data": {
    "id": "evt-uuid-newly-created-005",
    "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
    "type": "brainstorming",
    "description": "又玩游戏到半夜一点才睡，说好了要早睡的呢！",
    "status": "unresolved",
    "solution": null,
    "event_date": "2023-10-28",
    "images": [],
    "location_text": "卧室",
    "author": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "nickname": "付费用户A",
      "display_gender": "female"
    },
    "mood_tag": {
      "id": 1,
      "name": "生气",
      "emoji_icon": "😠"
    },
    "reactions": [],
    "resolved_at": null,
    "created_at": "2023-10-28T09:30:00Z",
    "updated_at": "2023-10-28T09:30:00Z"
  }
}
```

---

#### **13. `PUT /api/events/{eventId}` - 更新帖子（特别是"解决"操作）**
**用途**: 在帖子详情页，用户填写"解决办法"并点击"已解决"后，前端调用此接口。

**请求体 (Request Body)**:
```json
{
  "solution": "沟通了一下，他保证之后十一点半之前一定睡觉，还答应承包一个星期的家务作为补偿。",
  "status": "resolved"
}
```

**响应 (Response)**: (成功后，后端返回被完整更新后的帖子对象)
```json
{
  "code": 200,
  "message": "Event updated successfully.",
  "data": {
    "id": "evt-uuid-003",
    "couple_id": "c1p2l3e4-0002-4002-8002-654321fedcba",
    "type": "brainstorming",
    "description": "又把脏袜子扔在了沙发上，说了一百遍了！每次都得我跟在后面收拾。",
    "status": "resolved",
    "solution": "沟通了一下，他保证之后十一点半之前一定睡觉，还答应承包一个星期的家务作为补偿。",
    "event_date": "2023-10-24",
    "images": [],
    "location_text": null,
    "author": {
      "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff",
      "nickname": "付费用户B",
      "display_gender": "male"
    },
    "mood_tag": {
      "id": 3,
      "name": "无语",
      "emoji_icon": "😑"
    },
    "reactions": [],
    "resolved_at": "2023-10-28T10:00:00Z",
    "created_at": "2023-10-24T08:15:00Z",
    "updated_at": "2023-10-28T10:00:00Z"
  }
}
```

---

#### **14. `DELETE /api/events/{eventId}` - 删除帖子（逻辑删除）**
**用途**: 用户在自己的帖子上，点击删除按钮。

**响应 (Response)**:
```json
{
  "code": 200,
  "message": "Event successfully marked as deleted.",
  "data": {
    "id": "evt-uuid-003"
  }
}
```

---

#### **15. `POST /api/sweet-messages` - 新建甜蜜留言**
**用途**: 用户在"甜蜜留言板"页面发布新的留言。

**请求体 (Request Body)**:
```json
{
  "message": "今天也是超爱你的一天！",
  "nickname": "你的小太阳"
}
```

**响应 (Response)**: (成功后，后端返回完整的新建留言对象)
```json
{
  "code": 201,
  "message": "Sweet message posted successfully.",
  "data": {
    "id": "msg-uuid-newly-created-003",
    "message": "今天也是超爱你的一天！",
    "nickname": "你的小太阳",
    "is_pinned": false,
    "created_at": "2023-10-28T11:00:00Z",
    "author": {
      "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff",
      "display_gender": "male"
    }
  }
}
```

---

#### **16. `POST /api/couples/unbind` - 解绑情侣关系**
**用途**: 用户在设置中确认解绑。

**响应 (Response)**: (解绑成功后，返回一个全新的 `/api/me` 响应，状态变为 `UNBOUND`)
```json
{
  "code": 200,
  "message": "Couple unbound successfully.",
  "data": {
    "access_status": "UNBOUND",
    "currentUser": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "openid": "openid-for-paid-user-03",
      "nickname": "付费用户A",
      "avatar_url": "https://randomuser.me/api/portraits/women/68.jpg",
      "display_gender": "female",
      "bio": "享受每一刻的甜蜜记录。",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "light"
      },
      "last_login_at": "2023-10-28T11:30:00Z",
      "created_at": "2022-08-01T11:00:00Z"
    },
    "partner": null,
    "coupleInfo": null
  }
}
```

---

#### **17. `GET /api/analytics/mood` - 获取心情分析数据**
**用途**: 为"心情"页面的图表提供数据。

**场景 17.1: `?period=weekly` (周分析)**
```json
{
  "code": 200,
  "message": "Weekly mood analytics retrieved successfully.",
  "data": {
    "period_range": "2023-10-23 - 2023-10-29",
    "trend": {
      "labels": ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
      "datasets": [
        { "label": "付费用户A", "gender": "female", "data": [7, 8, 9, 8, 6, 10, 9] },
        { "label": "付费用户B", "gender": "male", "data": [8, 8, 7, 6, 7, 9, 8] }
      ]
    },
    "distribution": {
      "labels": ["开心", "感动", "生气", "无语"],
      "datasets": [{ "data": [4, 2, 1, 1], "backgroundColor": ["#FFDDC1", "#FFABAB", "#A7C7E7", "#C1E1C1"] }]
    }
  }
}
```

**场景 17.2: `?period=monthly` (月分析)**
```json
{
  "code": 200,
  "message": "Monthly mood analytics retrieved successfully.",
  "data": {
    "period_range": "2023-10-01 - 2023-10-31",
    "trend": {
      "labels": ["10.01", "10.02", "10.03", "10.04", "10.05", "...", "10.31"],
      "datasets": [
        { "label": "付费用户A", "gender": "female", "data": [8,9,8,7,7,9,10,8,7,6,8,9,9,10,8,7,8,9,6,7,8,9,10,9,8,7,6,9,10,8,8] },
        { "label": "付费用户B", "gender": "male", "data": [7,8,8,9,9,10,8,7,8,9,9,10,8,7,6,7,8,9,8,9,10,8,7,8,9,8,9,10,8,7,7] }
      ]
    },
    "distribution": {
      "labels": ["开心", "感动", "生气", "委屈", "无语", "平常", "惊喜"],
      "datasets": [{ "data": [25, 18, 10, 5, 8, 12, 7], "backgroundColor": ["#FFDDC1", "#FFABAB", "#A7C7E7", "#B9F2D4", "#C1E1C1", "#FDFD96", "#FFDFD3"] }]
    }
  }
}
```

---

#### **18. `PUT /api/me` - 更新用户个人资料**
**用途**: 用户在"我的"页面修改自己的昵称、头像、简介等信息。

**请求体 (Request Body)**:
```json
{
  "nickname": "改个新昵称",
  "bio": "新的简介，新的开始！"
}
```

**响应 (Response)**: (成功后，后端返回更新后的 `currentUser` 对象)
```json
{
  "code": 200,
  "message": "User profile updated successfully.",
  "data": {
    "currentUser": {
      "id": "e5f6g7h8-0009-4009-8009-1a2b3c4d5e6f",
      "openid": "openid-for-single-user-09",
      "nickname": "改个新昵称",
      "avatar_url": "https://randomuser.me/api/portraits/lego/1.jpg",
      "display_gender": "male",
      "bio": "新的简介，新的开始！",
      "status": "active",
      "is_admin": false,
      "preferences": {
        "notifications": {
          "new_event_push": true,
          "event_resolved_push": true,
          "new_message_push": true
        },
        "theme": "system"
      },
      "last_login_at": "2023-10-27T14:20:00Z",
      "created_at": "2023-09-01T20:00:00Z"
    }
  }
}
```