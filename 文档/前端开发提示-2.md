# **æ‹å¿ƒç‰©è¯­ - å¾®ä¿¡å°ç¨‹åºå¼€å‘æŒ‡ä»¤ (ç²¾ç®€ç‰ˆ)**

**é¡¹ç›®æ ‡è¯†**: `lianxin-wuyu-miniprogram`

---

## **æ ¸å¿ƒè¦æ±‚**

**ä½ çš„ä»»åŠ¡**: å¼€å‘ã€Œæ‹å¿ƒç‰©è¯­ã€å¾®ä¿¡å°ç¨‹åºçš„å…¨éƒ¨å‰ç«¯ä»£ç ã€‚ä½¿ç”¨å¾®ä¿¡å°ç¨‹åºåº”è¯¥ä½¿ç”¨åŸç”Ÿçš„è¯­æ³•

**æŠ€æœ¯æ ˆ**:
1. **æ¡†æ¶**: åŸç”Ÿå¾®ä¿¡å°ç¨‹åº (`WXML`, `WXSS`, `TypeScript`)
2. **UIåº“**: **iView Weapp** (å·²å®‰è£…åœ¨ `/miniapp/iview/`)
3. **çŠ¶æ€ç®¡ç†**: `mobx-miniprogram`
4. **æ ·å¼**: SCSS é¢„å¤„ç†å™¨
5. **ç›®å½•**: æ‰€æœ‰ä»£ç åœ¨ `/miniapp/` æ–‡ä»¶å¤¹å†…

**æ•°æ®å¥‘çº¦**: ä¸¥æ ¼æŒ‰ç…§æœ¬æ–‡æ¡£ç¬¬å››éƒ¨åˆ†çš„æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œå¼€å‘ã€‚

---

## **é¡¹ç›®ç»“æ„**

```
/miniapp/
|-- components/             # è‡ªå®šä¹‰ç»„ä»¶
|-- iview/                  # ã€å·²å­˜åœ¨ã€‘UIç»„ä»¶åº“
|-- pages/                  # æ‰€æœ‰é¡µé¢
|   |-- index/              # é¦–é¡µ
|   |-- auth/               # ç™»å½•é¡µ
|   |-- couple/             # æƒ…ä¾£ç»‘å®šé¡µ
|   |-- profile/            # ä¸ªäººä¸­å¿ƒ
|-- services/               # APIæœåŠ¡
|   |-- api.js              # è¯·æ±‚å°è£…
|-- store/                  # çŠ¶æ€ç®¡ç†
|   |-- user.js             # ç”¨æˆ·çŠ¶æ€
|   |-- event.js            # äº‹ä»¶çŠ¶æ€
|-- styles/                 # å…¨å±€æ ·å¼
|-- app.js                  # å…¥å£æ–‡ä»¶
|-- app.json                # å…¨å±€é…ç½®
```

---

## **iView Weapp ä½¿ç”¨è§„èŒƒ**

### **å…¨å±€å¼•å…¥** (åœ¨ `app.json` ä¸­)
```json
"usingComponents": {
  "i-button": "/iview/button/index",
  "i-card": "/iview/card/index",
  "i-tag": "/iview/tag/index",
  "i-progress": "/iview/progress/index",
  "i-avatar": "/iview/avatar/index",
  "i-icon": "/iview/icon/index"
}
```

### **ä¸»é¢˜è‰²è¦†ç›–** (åœ¨ `app.wxss` ä¸­)
```css
page {
  background-color: #FFF9F5;
  --primary-color: #FADADD;
  --info-color: #B2D9EA;
}
```

### **ç»„ä»¶ä½¿ç”¨æ˜ å°„**
| éœ€æ±‚ | ç»„ä»¶ | å…³é”®å±æ€§ |
|------|------|----------|
| ä¸»æŒ‰é’® | `i-button` | `type="primary" size="large"` |
| å¡ç‰‡ | `i-card` | `full="true"` |
| æ ‡ç­¾ | `i-tag` | `color="primary"` æˆ– `color="info"` |
| è¿›åº¦æ¡ | `i-progress` | `stroke-color="#FADADD"` |
| å¤´åƒ | `i-avatar` | `src="{{url}}" shape="circle"` |

---

## **å¼€å‘è·¯çº¿**

### **Phase 1: è®¤è¯æµç¨‹**
1. **ç™»å½•é¡µ** (`pages/auth/index`)
   - UI: ä½¿ç”¨ `<i-button type="primary">å¾®ä¿¡æˆæƒç™»å½•</i-button>`
   - é€»è¾‘: `wx.login()` â†’ è°ƒç”¨ç™»å½•API â†’ å­˜å‚¨token â†’ è·³è½¬

2. **ç»‘å®šé¡µ** (`pages/couple/index`)
   - UI: ä½¿ç”¨ `i-panel`ã€`i-input`ã€`i-button`
   - é€»è¾‘: ç”Ÿæˆé‚€è¯·ç  â†’ è¾“å…¥å¯¹æ–¹é‚€è¯·ç  â†’ ç»‘å®šæˆåŠŸ

### **Phase 2: æ ¸å¿ƒåŠŸèƒ½**
1. **é¦–é¡µ** (`pages/index/index`)
   - UI: `i-avatar` + `i-progress` + `i-card` åˆ—è¡¨
   - é€»è¾‘: å±•ç¤ºæƒ…ä¾£ä¿¡æ¯ã€çˆ±æƒ…æŒ‡æ•°ã€æœªè§£å†³äº‹ä»¶

2. **å…¶ä»–é¡µé¢**: äº‹ä»¶è¯¦æƒ…ã€æ–°å¢äº‹ä»¶ã€ä¸ªäººä¸­å¿ƒç­‰

---

## **å…³é”®æ¨¡æ‹Ÿæ•°æ®**

### **1. ç”¨æˆ·ä¼šè¯ä¿¡æ¯** (`GET /api/me`)

**ä»˜è´¹ç”¨æˆ·åœºæ™¯**:
```json
{
  "code": 200,
  "data": {
    "access_status": "FULL_ACCESS",
    "currentUser": {
      "id": "b2c3d4e5-0003-4003-8003-112233445566",
      "nickname": "ä»˜è´¹ç”¨æˆ·A",
      "avatar_url": "https://randomuser.me/api/portraits/women/68.jpg",
      "display_gender": "female"
    },
    "partner": {
      "id": "b2c3d4e5-0004-4004-8004-aabbccddeeff",
      "nickname": "ä»˜è´¹ç”¨æˆ·B",
      "avatar_url": "https://randomuser.me/api/portraits/men/68.jpg",
      "display_gender": "male"
    },
    "coupleInfo": {
      "id": "c1p2l3e4-0002-4002-8002-654321fedcba",
      "anniversary_date": "2022-08-08",
      "subscription_expires_at": "2024-09-08T12:00:00Z"
    }
  }
}
```

**æœªç»‘å®šç”¨æˆ·åœºæ™¯**:
```json
{
  "code": 200,
  "data": {
    "access_status": "UNBOUND",
    "currentUser": {
      "id": "e5f6g7h8-0009-4009-8009-1a2b3c4d5e6f",
      "nickname": "å•èº«è´µæ—C",
      "avatar_url": "https://randomuser.me/api/portraits/lego/1.jpg"
    },
    "partner": null,
    "coupleInfo": null
  }
}
```

### **2. äº‹ä»¶åˆ—è¡¨** (`GET /api/events?status=unresolved`)
```json
{
  "code": 200,
  "data": [
    {
      "id": "evt-uuid-001",
      "type": "brainstorming",
      "description": "è¯´å¥½çš„ä¸€èµ·çœ‹ç”µå½±ï¼Œç»“æœå¼€åœºååˆ†é’Ÿå°±ç¡ç€äº†ï¼",
      "status": "unresolved",
      "event_date": "2023-10-26",
      "author": {
        "id": "b2c3d4e5-0003-4003-8003-112233445566",
        "nickname": "ä»˜è´¹ç”¨æˆ·A",
        "display_gender": "female"
      },
      "mood_tag": {
        "id": 1,
        "name": "ç”Ÿæ°”",
        "emoji_icon": "ğŸ˜ "
      },
      "created_at": "2023-10-26T22:30:00Z"
    }
  ]
}
```

### **3. æƒ…ç»ªæ ‡ç­¾** (`GET /api/mood-tags`)
```json
{
  "code": 200,
  "data": [
    { "id": 1, "name": "ç”Ÿæ°”", "emoji_icon": "ğŸ˜ ", "category": "negative" },
    { "id": 2, "name": "å§”å±ˆ", "emoji_icon": "ğŸ¥º", "category": "negative" },
    { "id": 5, "name": "æ„ŸåŠ¨", "emoji_icon": "ğŸ¥°", "category": "positive" },
    { "id": 6, "name": "å¼€å¿ƒ", "emoji_icon": "ğŸ˜„", "category": "positive" }
  ]
}
```

### **4. åˆ›å»ºé‚€è¯·ç ** (`POST /api/couples/invitations`)
```json
{
  "code": 200,
  "data": {
    "invite_code": "A8C3F9",
    "expires_at": "2023-10-28T14:55:00Z"
  }
}
```

---

## **çŠ¶æ€ç®¡ç†å®ç°**

### **ç”¨æˆ·Store** (`store/user.js`)
```javascript
import { observable, action } from 'mobx-miniprogram'

export const userStore = observable({
  currentUser: null,
  partner: null,
  coupleInfo: null,
  accessStatus: 'UNBOUND',

  fetchUserSession: action(function() {
    // è°ƒç”¨ GET /api/me
    // æ›´æ–°ä¸Šè¿°çŠ¶æ€
  }),

  get isCoupleBound() {
    return this.accessStatus !== 'UNBOUND'
  }
})
```

---

## **APIæœåŠ¡å°è£…** (`services/api.js`)
```javascript
const BASE_URL = '/api'

function request(url, options = {}) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: BASE_URL + url,
      method: options.method || 'GET',
      data: options.data,
      header: {
        'Authorization': `Bearer ${wx.getStorageSync('access_token')}`,
        ...options.header
      },
      success: (res) => {
        if (res.data.code === 401) {
          wx.removeStorageSync('access_token')
          wx.reLaunch({ url: '/pages/auth/index' })
          return
        }
        resolve(res.data)
      },
      fail: reject
    })
  })
}

export default { request }
```

---

## **æ‰§è¡ŒæŒ‡ä»¤**

æŒ‰ç…§ä¸Šè¿°è§„èŒƒå’Œæ•°æ®ï¼Œä»Phase 1å¼€å§‹ï¼Œåˆ›å»ºæ ‡å‡†å°ç¨‹åºæ–‡ä»¶å¹¶ç¼–å†™ä»£ç ã€‚ç¡®ä¿æ‰€æœ‰UIé€šè¿‡iView Weappå®ç°ï¼Œæ‰€æœ‰æ•°æ®ç»“æ„ä¸æ¨¡æ‹Ÿæ•°æ®å®Œå…¨åŒ¹é…ã€‚
